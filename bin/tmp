#!/bin/bash
set -e

export DEBUG=1
export NO_RESTART_LOOP=1
export CYPRESS_BASE_URL=http://localhost:8080
export OPT_OUT_CAPTURE=1
export SECURE_COOKIES=0
export SKIP_SERVICE_VERSION_REQUIREMENTS=1
export KAFKA_URL=kafka://kafka:9092
export CLICKHOUSE_DATABASE=posthog_test
export TEST=1 # Plugin server and kafka revert to 'default' Clickhouse database if TEST is not set
export CLICKHOUSE_SECURE=0
export E2E_TESTING=1
export SECRET_KEY=e2e_test
export EMAIL_HOST=email.test.posthog.net
export SITE_URL=http://localhost:8080
export REDIS_URL=redis://localhost/
# DATABASE="posthog_e2e_test"
# export PGHOST="${PGHOST:=localhost}"
# export PGUSER="${PGUSER:=posthog}"
# export PGPASSWORD="${PGPASSWORD:=posthog}"
# export PGPORT="${PGPORT:=5432}"
# export DATABASE_URL="postgres://${PGUSER}:${PGPASSWORD}@${PGHOST}:${PGPORT}/${DATABASE}"

DEBUG=1 pnpm exec playwright test -c playwright.e2e.config.ts

