#!/bin/sh
SCRIPT_DIR=$(dirname "$(readlink -f "$0")")

DATABASE_NAME=${DATABASE_NAME:-cyclotron}
DATABASE_URL=${DATABASE_URL:-postgres://posthog:posthog@localhost:5432/$DATABASE_NAME}

echo "Performing cyclotron migrations for $DATABASE_URL (DATABASE_NAME=$DATABASE_NAME)"

sqlx database create -D "$DATABASE_URL"
sqlx migrate run -D "$DATABASE_URL" --source $SCRIPT_DIR/../cyclotron-core/migrations
